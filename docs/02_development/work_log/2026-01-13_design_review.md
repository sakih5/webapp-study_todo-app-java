# 作業ログ: 2026-01-13 (設計レビューと修正編)

## 学習情報

- **日付**: 2026-01-13
- **学習フェーズ**: WBS 1.1 設計フェーズ - レビューと修正
- **学習時間**: 約1時間
- **ステータス**: 設計フェーズ完了、WBS 1.1 完了

---

## 完了したタスク

### レビュー対象ドキュメント

1. **REQUIREMENTS.md** - 要件定義書
2. **table_definitions.md** - データベース設計
3. **api_design.md** - API設計
4. **ワイヤーフレーム** - 画面設計

---

## レビューの目的

### なぜレビューが必要か

**1. 整合性の確認**
- すべてのドキュメントが矛盾していないか
- データモデル、API、UIが一致しているか

**2. 実装可能性の確認**
- 設計に抜け漏れがないか
- 実装時に迷わない詳細度か

**3. 品質の向上**
- より良い設計にできる箇所はないか
- ベストプラクティスに従っているか

---

## レビューで発見した不整合と修正内容

### 1. priorityの型が統一されていない

**問題点:**
- REQUIREMENTS.md: Enum (HIGH, MEDIUM, LOW)
- table_definitions.md: INT (1-5)
- api_design.md: INT (1-5)

**修正内容:**
- REQUIREMENTS.mdをINT (1-5)に統一

**修正理由:**
- ソートが簡単（数値の大小比較）
- APIで配列フィルタ`"priority": [3,4,5]`が使える
- フロントエンドで表示を変えられる

**修正後の定義:**
```
priority: INT (1-5)
  - 1: 最低
  - 2: 低
  - 3: 中（デフォルト）
  - 4: 高
  - 5: 最高
```

---

### 2. 論理削除のフィールド名が統一されていない

**問題点:**
- table_definitions.md: `is_deleted` (BOOLEAN)
- api_design.md（一部レスポンス例）: `deleted_at` (DATETIME)

**修正内容:**
- すべて`deleted_at` (DATETIME)に統一

**修正理由:**
- いつ削除されたかが分かる
- `deleted_at IS NULL`で未削除を判定できる（SQLでよく使われるパターン）
- Phase 3で監査機能を追加する際に有利

**修正箇所:**
- table_definitions.md: `is_deleted` → `deleted_at`
- すべてのテーブル（User, Category, Todo）

---

### 3. descriptionフィールドがテーブル定義に欠落

**問題点:**
- REQUIREMENTS.md: Todoに`description: Text (Nullable)`がある
- table_definitions.md: `description`フィールドがない
- api_design.md: descriptionの記載なし

**修正内容:**
- table_definitions.mdに追加：`description TEXT NULL OK`
- api_design.mdに追加：
  - POST /api/todos のリクエスト・レスポンス
  - PATCH /api/todos/{id} のリクエスト・レスポンス・バリデーション
  - POST /api/todos/search のレスポンス

**修正理由:**
- タイトルだけでは情報が足りないことが多い
- Phase 1から含める方が実装が楽

---

### 4. エラーコードの体系化

**問題点:**
- エラーコードが個別に定義されていたが、体系化されていなかった

**修正内容:**
- エラーコード体系を追加：
  - **認証エラー**: `AUTH_xxx`
  - **バリデーションエラー**: `VALIDATION_xxx`
  - **リソースエラー**: `RESOURCE_xxx`

**修正理由:**
- 一貫性が高まる
- 機械的な判定が容易
- 管理しやすい

**追加したエラーコード:**
```
AUTH_xxx:
  - AUTH_MISSING_TOKEN
  - AUTH_INVALID_TOKEN
  - AUTH_EXPIRED_TOKEN
  - AUTH_INVALID_CREDENTIALS

VALIDATION_xxx:
  - VALIDATION_REQUIRED_FIELD
  - VALIDATION_INVALID_FORMAT

RESOURCE_xxx:
  - RESOURCE_NOT_FOUND
  - RESOURCE_ALREADY_EXISTS
  - RESOURCE_FORBIDDEN
```

---

### 5. 新規エンドポイントの追加

**追加したエンドポイント:**
1. **POST /api/auth/logout** - ログアウト
2. **GET /api/auth/me** - 現在のユーザー情報取得

**追加理由:**
- **logout**: 将来の監査ログ・トークン失効方式への拡張を見据えて
- **me**: フロントエンドで現在のユーザー情報を取得できるようにする

---

## レビューで確認したが修正しなかった項目

### 1. created_at, updated_at, completed_at

**確認内容:**
- table_definitions.mdに含まれていない

**判断:**
- **Phase 1では含めない**
- 必要になったらマイグレーションで追加できる
- YAGNI原則（You Aren't Gonna Need It）に従う

**理由:**
- シンプルに始める
- 最初から完璧を求めない
- 学習目的として適切

---

## レビューを通じて学んだこと

### 1. 設計レビューの重要性

**レビューで防げる問題:**
- 実装時の迷い
- 後からの大きな修正
- データモデルの不整合

**レビューのタイミング:**
- 実装前に必ず実施
- できれば第三者にレビューしてもらう
- 自分でも時間を置いてからレビュー

---

### 2. ドキュメント間の整合性

**重要な整合性:**
1. **データモデル ↔ API**: レスポンスに含まれるフィールドが一致
2. **API ↔ UI**: UIで表示するデータがAPIで取得できる
3. **要件定義 ↔ 詳細設計**: 要件が設計に反映されている

**整合性を保つ方法:**
- 1つ修正したら、関連するドキュメントも更新
- レビュー時に横断的にチェック

---

### 3. YAGNI原則（You Aren't Gonna Need It）

**意味:**
- 必要になるまで実装しない
- 推測で機能を追加しない

**適用例:**
- created_at, updated_at: 今は不要、必要になったら追加
- completed_at: Phase 2で追加予定
- estimated_time: Phase 2で追加予定

**メリット:**
- シンプルな設計
- 実装が速い
- 保守が容易

---

### 4. 設計の完璧さ vs 実装の開始

**完璧を求めすぎない:**
- 設計は80%の完成度でOK
- 実装しながら気づくこともある
- アジャイル開発では、小さく始めて改善していく

**最低限必要な設計:**
- データモデル（テーブル定義）
- API仕様（エンドポイント、リクエスト・レスポンス）
- UI（ワイヤーフレーム）

---

## 修正完了後の確認

### 整合性チェックリスト

- [x] priorityの型が統一されている（INT 1-5）
- [x] 論理削除フィールドが統一されている（deleted_at）
- [x] descriptionフィールドがすべてのドキュメントに含まれている
- [x] エラーコードが体系化されている
- [x] APIエンドポイントが揃っている（12エンドポイント）
- [x] ワイヤーフレームとAPIが一致している

---

## WBS 1.1 設計フェーズの総括

### 作成した成果物

1. **要件定義書**（REQUIREMENTS.md）
   - プロジェクトの目的
   - 技術スタック
   - Phase分けされた機能要件
   - データモデル概要
   - 非機能要件

2. **データベース設計**（table_definitions.md）
   - 3テーブルの定義（User, Category, Todo）
   - リレーション定義
   - インデックス設計
   - ER図

3. **API設計**（api_design.md）
   - 12エンドポイントの詳細設計
   - リクエスト・レスポンススキーマ
   - エラーレスポンス定義
   - バリデーションルール

4. **ワイヤーフレーム**
   - 5画面のレイアウト
   - 画面遷移図

---

### 学んだ設計の原則

1. **段階的な開発（Phase分け）**
   - MVP（最小限の機能）から始める
   - 小さな成功体験を積む

2. **YAGNI原則**
   - 必要になるまで実装しない
   - シンプルさを保つ

3. **整合性の重要性**
   - すべてのドキュメントが一致している
   - 実装時に迷わない

4. **レビューの重要性**
   - 実装前に必ずレビュー
   - 不整合を早期に発見

5. **柔軟性を持たせる**
   - 後から変更できる設計
   - マイグレーションで拡張可能

---

## 次のステップ：WBS 1.2 環境構築・Spring Boot学習

設計フェーズが完了したので、次は実装の準備を始めます。

### WBS 1.2.1 Spring Boot基礎学習（1.3日）

**学習内容:**
1. Spring Bootの基本概念
2. アノテーションの理解（@RestController, @Service, @Repository など）
3. 依存性注入（DI）とIoC
4. Spring Bootプロジェクトの構造

### WBS 1.2.2 環境構築（0.7日）

**作業内容:**
1. Spring Bootプロジェクトの作成（Spring Initializr）
2. PostgreSQLのインストールと設定
3. Spring BootとPostgreSQLの接続確認
4. Hello World APIの作成とテスト

---

## まとめ

設計レビューを通じて、すべてのドキュメントの整合性が取れました。

**達成したこと:**
- ✅ 4つの不整合を発見・修正
- ✅ エラーコードの体系化
- ✅ 新規エンドポイントの追加
- ✅ YAGNI原則に従った判断

**学んだこと:**
- 設計レビューの重要性
- ドキュメント間の整合性の保ち方
- YAGNI原則の適用
- 完璧さより実装開始のタイミング

**WBS 1.1 設計フェーズ - 100%完了！**

次のフェーズ（環境構築・Spring Boot学習）に進む準備が整いました。

---

**作成日**: 2026-01-13
**WBS進捗**: 1.1 設計フェーズ 完了 → 1.2 環境構築・Spring Boot学習へ
