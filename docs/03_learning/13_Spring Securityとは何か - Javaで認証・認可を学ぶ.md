## 1. Spring Securityとは何か

Spring Securityは、Spring（特にSpring Boot）で構築された**Webアプリケーションのセキュリティ全般**を担うフレームワーク。

主に以下を担当する:

- 認証（ログイン処理）
- 認可（アクセス制御）
- セッション管理 / トークン管理
- CSRF対策
- パスワードの安全な取り扱い
- フィルタチェーンによるリクエスト制御

**具体的に何を守るか？**

Spring Securityが守る対象は「ログイン画面」だけでなく、
「誰が」「何をしてよいか」を**アプリ全体で一貫して制御**する。

| 脅威      | 具体的に何を防ぐか            |
| ------- | -------------------- |
| 不正アクセス  | ログインしていないユーザーがAPIを叩く |
| なりすまし   | 他人のIDとして操作する         |
| 権限逸脱    | 一般ユーザーが管理者APIを実行     |
| パスワード漏洩 | DB流出時の被害拡大           |
| CSRF    | 勝手に操作させられる攻撃         |

## 2. 認証（Authentication）と認可（Authorization）の違い

| 用語 | 英語 | 意味 |
|------|------|------|
| 認証 | Authentication | 入口チェック（あなたは誰ですか？） |
| 認可 | Authorization  | APIごとの権限チェック（あなたは何をしていいですか？） |

❌「ログインできる = 全部できる」
❌「認証と認可は同じ」

**それぞれ何を確認するものか？**:

認証（Authentication）

- ユーザーの**本人確認**
- 「このリクエストは誰から来たのか？」を確定する
- 例: メールアドレス + パスワード / JWTトークン / セッションID

認可（Authorization）

- 認証されたユーザーが**何をしてよいか**を判定
- 権限・ロール・所有者チェックなど
- 例: ADMINだけが使えるAPI / 自分のTodoだけ編集可能

**具体例（Todoアプリで言うと何？）**:

認証の例（`POST /api/auth/login`）

- メールアドレスとパスワードが正しいか？
- 正しければ「ログイン済みユーザー」として扱う

→ ここまでが認証

認可の例（`GET /api/todos`）

- ログインしているか？ → OK
- JWTのuser_idを取得
- そのuser_idのTodoだけを返す

認可の例（`DELETE /api/admin/users`）

- ログインしているか？ → OK
- ロールがADMINか？ → ここで拒否される可能性あり

→ ここが認可

## 3. PasswordEncoderとは

**なぜパスワードをそのまま保存してはいけないのか？**

パスワードをそのまま（平文）保存していると、DBが漏洩した際に全ユーザのパスワードが即バレしてしまうから。

**ハッシュ化とは？**

パスワードを、規則性のない英数字 + 記号 を使った文字列に変換する処理のこと。

- 同じパスワードであれば何回やっても同じパスワードになる（冪等性）
- ハッシュから平文に戻すことはできない（不可逆性）
- パスワードが合っているかの照合は「同じハッシュになるか」で行う

**PasswordEncoderの役割**

Spring Securityの PasswordEncoder は

- パスワードを安全にハッシュ化
- ログイン時に正しいかを検証

```java
passwordEncoder.encode(rawPassword)
passwordEncoder.matches(rawPassword, encodedPassword)
```

**BCryptとは？**

PasswordEncoderの代表的な実装のこと。

| 特徴       | 説明            |
| -------- | ------------- |
| ソルト付き    | レインボーテーブル攻撃対策 |
| 計算コストが高い | 総当たり攻撃に強い     |
| 可変強度     | 将来の計算能力向上に対応  |

Spring Bootでは事実上の標準。

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```
